#!/bin/bash

echo "=========================================="
echo "    EMail Malware Analyzer Setup (Linux)  "
echo "=========================================="

echo "[*] Checking for Docker & Docker Compose..."
if ! command -v docker &> /dev/null || ! docker compose version &> /dev/null; then
    echo "[-] Error: Docker and Docker Compose are required to run this project."
    echo "    Please install them and try again."
    exit 1
fi
echo "[+] Docker is installed."

echo "[*] Cloning the College-Projects repository (if not exists)..."
if [ ! -d "College-Projects" ]; then
    git clone https://github.com/1Z4t-R3p0/College-Projects.git
    if [ $? -ne 0 ]; then
        echo "[-] Failed to clone repository."
        exit 1
    fi
else
    echo "[+] Repository already exists. Pulling latest changes..."
    cd College-Projects
    git pull
    cd ..
fi

echo "[*] Navigating to EMailmalware-anlayser directory..."
cd College-Projects/EMailmalware-anlayser || exit 1

echo "[*] Starting Docker containers..."
docker compose up -d --build

if [ $? -eq 0 ]; then
    echo "=========================================="
    echo "    System successfully deployed!         "
    echo "=========================================="
    echo "Access the application at: http://localhost"
    echo "Note: The ClamAV container may take a few minutes to download signatures on the first boot."
else
    echo "[-] Failed to start Docker containers."
    exit 1
fi
