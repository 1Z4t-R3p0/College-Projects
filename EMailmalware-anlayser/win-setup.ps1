Write-Host "==========================================" -ForegroundColor Cyan
Write-Host "   EMail Malware Analyzer Setup (Windows) " -ForegroundColor Cyan
Write-Host "==========================================" -ForegroundColor Cyan

# Check for Docker
Write-Host "[*] Checking for Docker..."
if (-not (Get-Command docker -ErrorAction SilentlyContinue) -or -not (Get-Command docker-compose -ErrorAction SilentlyContinue -and (docker compose version 2>&1))) {
    Write-Host "[-] Error: Docker and Docker Compose are required to run this project." -ForegroundColor Red
    Write-Host "    Please install Docker Desktop and try again." -ForegroundColor Red
    exit
}
Write-Host "[+] Docker is installed." -ForegroundColor Green

# Clone Repository
Write-Host "[*] Cloning the College-Projects repository..."
if (-not (Test-Path "College-Projects")) {
    git clone https://github.com/1Z4t-R3p0/College-Projects.git
    if ($LASTEXITCODE -ne 0) {
        Write-Host "[-] Failed to clone repository." -ForegroundColor Red
        exit
    }
} else {
    Write-Host "[+] Repository already exists. Pulling latest changes..." -ForegroundColor Green
    Set-Location College-Projects
    git pull
    Set-Location ..
}

# Navigate to project
Write-Host "[*] Navigating to EMailmalware-anlayser directory..."
Set-Location College-Projects\EMailmalware-anlayser

# Start Docker
Write-Host "[*] Starting Docker containers..."
docker compose up -d --build

if ($LASTEXITCODE -eq 0) {
    Write-Host "==========================================" -ForegroundColor Cyan
    Write-Host "    System successfully deployed!         " -ForegroundColor Green
    Write-Host "==========================================" -ForegroundColor Cyan
    Write-Host "Access the application at: http://localhost" -ForegroundColor Yellow
    Write-Host "Note: The ClamAV container may take a few minutes to download signatures on the first boot." -ForegroundColor Yellow
} else {
    Write-Host "[-] Failed to start Docker containers." -ForegroundColor Red
}
